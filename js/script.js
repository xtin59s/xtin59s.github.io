let startBtn=document.getElementById("startBtn"),stopBtn=document.getElementById("stopBtn"),audioPlayer=document.getElementById("audioPlayer"),audioContext,mediaStream,mediaRecorder,audioChunks=[];function audioBufferToWav(t){var e=t.numberOfChannels,n=t.sampleRate,a=t.length,i=new ArrayBuffer(44+2*a),o=new DataView(i),r=(writeString(o,0,"RIFF"),o.setUint32(4,36+2*a,!0),writeString(o,8,"WAVE"),writeString(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,e,!0),o.setUint32(24,n,!0),o.setUint32(28,n*e*2,!0),o.setUint16(32,2*e,!0),o.setUint16(34,16,!0),writeString(o,36,"data"),o.setUint32(40,2*a,!0),t.getChannelData(0));let d=44;for(let t=0;t<a;t++){var s=Math.max(-1,Math.min(1,r[t]));o.setInt16(d,32767*s,!0),d+=2}return new Blob([o],{type:"audio/wav"})}function writeString(e,n,a){for(let t=0;t<a.length;t++)e.setUint8(n+t,a.charCodeAt(t))}startBtn.addEventListener("click",()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{audioContext=new(window.AudioContext||window.webkitAudioContext),mediaStream=t;var t=audioContext.createMediaStreamSource(t),e=audioContext.createScriptProcessor(2048,1,1);t.connect(e),e.connect(audioContext.destination),e.onaudioprocess=function(t){t=t.inputBuffer.getChannelData(0);console.log(t),audioChunks.push(new Float32Array(t))},startBtn.disabled=!0,stopBtn.disabled=!1,mediaRecorder=e}).catch(t=>{console.error("Error accessing audio devices:",t)})}),stopBtn.addEventListener("click",()=>{mediaRecorder&&mediaRecorder.disconnect();var t=audioContext.createBuffer(1,2048*audioChunks.length,audioContext.sampleRate);let e=t.getChannelData(0),n=0;audioChunks.forEach(t=>{e.set(t,n),n+=t.length});t=audioBufferToWav(t),t=URL.createObjectURL(t);audioPlayer.src=t,startBtn.disabled=!1,stopBtn.disabled=!0});